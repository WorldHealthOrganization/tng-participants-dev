name: Download Secrets to Test1

on:
  workflow_dispatch:

jobs:
  download-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Download Secrets as Base64 (Test1)
        run: |
          mkdir -p secrets/test1
          # Use a distinct staging file name to avoid confusion
          echo '${{ toJson(secrets) }}' > secrets_base64.json
          cat secrets_base64.json | jq -r 'keys[] as $k | "\($k):\(.[$k])"' | while IFS=: read -r name value; do
            # Sanitize the secret name to make it safe for filenames
            safe_name=$(echo "$name" | tr -cd '[:alnum:]_-')
            # Encode each secret value in base64 and save to file
            echo -n "$value" | base64 > "secrets/test1/${safe_name}.b64"
          done
          echo "List created files"
          ls -la secrets/test1

      - name: Upload secrets as artifact1
        uses: actions/upload-artifact@v4
        with:
          name: secrets-test1
          path: secrets/test1
