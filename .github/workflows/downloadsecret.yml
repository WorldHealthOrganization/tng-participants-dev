name: Download and Decode Secrets to Test1

on:
  workflow_dispatch:

jobs:
  download-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Download and Decode Secrets (Test1)
        run: |
          mkdir -p secrets/test1
          
          # Loop through all GitHub secrets and write them directly to files
          for secret_name in $(jq -r 'keys[]' <<< '${{ toJson(secrets) }}'); do
            secret_value=$(jq -r --arg k "$secret_name" '.[$k]' <<< '${{ toJson(secrets) }}')
            # Sanitize the secret name for safe filenames
            safe_name=$(echo "$secret_name" | tr -cd '[:alnum:]_-')
            # Write the raw secret value directly to a file
            echo -n "$secret_value" > "secrets/test1/${safe_name}.txt"
            # Print a preview in logs (first 60 chars) so you can confirm
            preview=$(echo -n "$secret_value" | cut -c1-60)
            echo "Created ${safe_name}.txt â†’ ${preview}..."
          done

          echo "List created files:"
          ls -lh secrets/test1

      - name: Upload decoded secrets as artifact
        uses: actions/upload-artifact@v4
        with:
          name: secrets-test1-decoded
          path: secrets/test1
